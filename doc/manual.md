## 概要
本アプリは，chatGPTを始めとするLLMや自然言語処理を用いて組織内文書を検索，質問に対する応答を生成することで，オフィスワークを支援することを目的に開発中です．現在基本的な質問応答処理，必要な関連情報の部分選択処理を実装しています．

## 使い方
### 下準備
1. [OpenAI APIキー](https://platform.openai.com/account/api-keys)を取得します
2. プロジェクトの`.env.sample`ファイルをコピーし，`.env`としたうえで，`OPENAI_API_KEY`の値として先程のAPIキーの値をコピペします
   - e.g. `OPENAI_API_KEY=hogefugapiyo1234567890asdfghjkl`
3. プロジェクト直下で`docker compose up -d`を実行します

### アプリへのアクセス
1. 動かしているマシンの8501ポートへブラウザからhttpアクセス

### pdfファイルを登録(アップロード)する
組織内文書は一度アプリにアップロードして登録する必要があります
1. 左側のメニューの`モード`から，`PDFをアップロード`を選択
1. `Drag and drop files here`と書かれている場所にファイルをドラッグするか，その右側の`Browse files`からファイルを選択します．
   - 現状アップロードできるのはPDFファイルのみです
   - 同時に複数ファイルを選択することができます
1. ファイルをアップロードすると，`前処理開始`というボタンが出現するのでクリックして実行します．
   - ここでは，ファイル内のテキストをベクトル形式に変換(Embedding)してデータベースに保存する処理を行っています
   - 処理中は画面内のボタンの操作，ページリロードをしないでください
1. 処理が終了すると，`処理が完了しました`と表示され，下に`OK`ボタンが出現するのでクリックします．
1. これで，PDFの情報をアプリに登録できました．追加でファイルをアップロードしたいときは，同じページから同様の手順で操作します．
   - PDFファイルはいつでも好きなだけ追加していただけます

### エージェントに質問する
PDFファイルを登録したら，エージェントに質問してみましょう．エージェントは登録したPDFの情報を使って質問に回答してくれます．
1. 左側のメニューの`モード`から，`組織内文書へ質問`を選択
2. *text_area*に質問を入力し，`質問する`ボタンをクリック
3. エージェントから回答が返ってきます．組織内情報を用いている場合は，それに関連するPDFファイルが引用の形式で表示されます．
   - 回答が返ってくるまでの時間は非常に不安定です．場合によっては4分程度かかることもありますが故障ではありません．
     - OpenAI社のAPIに依存しているため，アクセスが混雑する夜中などに遅くなりやすいです．対策を考え中です．
   - 引用の形式は`[0-2]`などとなっていますが，前の数字がファイル番号，後ろの数字が内部プログラム用の識別番号となっています．
     - 引用情報として表示される情報はファイル名のみです．
   - 引用されたPDFファイルは引用情報の書いてあるボタンからダウンロードすることができます．

## その他細かい説明
- 左側のメニューの下側には，そのセッションで発生したAPIの利用料金の合計が**Total cost**として表示されます．質問毎の料金はその下に新しい順で並んでいます
- PDFアップロードの際の右側の数値は，文書を何文字で切り分けるかを設定しています．
- 質問の際にはchatGPTのモデルを選択することができます．入力エリアの右側にある選択肢から選んでください．
- 質問の際には一度に取得する参考情報数を変更することができます．入力エリアの右側にある入力ボックスから入力してください．
  - 値が大きいほど取ってくる情報が増えるので，精度が上がる可能性があります．なお，その分料金が高くなり，またモデルの入力上限に到達しやすくなります．
- 同一セッション内の質問応答は全て表示されます．ただし，現状1つ前の質問応答の記憶を引き継がないので，それぞれ個別の回答となります．

## 内部情報
### ログデータ
- ログデータがホスト側の`workspace/app/logs`にJSON Linesで保存されます．pdfファイルのアップロード時の情報や質問時の情報が記録されていきます．
### ベクトルデータ
- ベクトルデータは`Qdrant`というベクトルDBに保存されます．ファイルはホスト側の`qdrant/storage/collections`の中に，`kadagpt_1`という名前で存在します．これを消去することで，登録したベクトルデータを全て削除することもできます．
### PDFファイル
- アップロードされたPDFファイルはホスト側の`workspace/app/reference_files`に保存されます．

## サポート情報
もし不具合などが発生しましたら，現地に参上して対処させていただきます．